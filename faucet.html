<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RIALO Faucet - Claim Free RIALO</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .hologram-bg{position:fixed;inset:0;background:
      linear-gradient(125deg,#0a0a0a 0%,#1a1a2e 30%,#16213e 60%,#0f3460 100%),
      url('https://assets.unicorn.studio/images/l2abTweJIYXF5iLWv6Kkx9VkeC23/aVector_v1.svg'),
      url('https://assets.unicorn.studio/media/blue_noise_med.png');
      background-size:400% 400%,cover,200px;background-position:0% 0%,center,center;background-repeat:no-repeat,no-repeat,repeat;
      animation:hologramMove 20s ease infinite;z-index:-2}
    @keyframes hologramMove{0%{background-position:0% 0%,center,center}25%{background-position:100% 0%,center,center}50%{background-position:100% 100%,center,center}75%{background-position:0% 100%,center,center}100%{background-position:0% 0%,center,center}}
    .hologram-overlay{position:fixed;inset:0;background:
      radial-gradient(circle at 20% 80%,rgba(120,119,198,.1) 0%,transparent 50%),
      radial-gradient(circle at 80% 20%,rgba(255,119,198,.1) 0%,transparent 50%),
      radial-gradient(circle at 40% 40%,rgba(120,219,255,.05) 0%,transparent 50%);
      animation:hologramPulse 8s ease-in-out infinite;z-index:-1}
    @keyframes hologramPulse{0%,100%{opacity:.5}50%{opacity:.8}}
    .glass-card{background:rgba(30,30,46,.7);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1)}
    .gradient-bg{background:linear-gradient(135deg,rgba(102,126,234,.8) 0%,rgba(118,75,162,.8) 100%);backdrop-filter:blur(5px)}
    .card-hover{transition:transform .3s, box-shadow .3s}.card-hover:hover{transform:translateY(-5px);box-shadow:0 10px 25px rgba(0,0,0,.3)}
    .progress-bar{height:8px;border-radius:4px;background-color:rgba(55,65,81,.5);overflow:hidden}
    .progress-fill{height:100%;border-radius:4px;transition:width .5s}
    ::-webkit-scrollbar{width:8px}::-webkit-scrollbar-track{background:rgba(30,30,46,.5)}::-webkit-scrollbar-thumb{background:rgba(102,126,234,.5);border-radius:4px}::-webkit-scrollbar-thumb:hover{background:rgba(102,126,234,.8)}
  </style>
</head>
<body class="min-h-screen text-white">
  <div class="hologram-bg"></div><div class="hologram-overlay"></div>

  <header class="bg-gray-900/80 backdrop-blur-md shadow-sm sticky top-0 z-10 border-b border-gray-700">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <a href="https://www.rialo.io/" target="_blank" class="flex items-center space-x-2 hover:opacity-80">
        <img src="https://cdn.prod.website-files.com/6883572e6ebf68cfe676dd65/6883572e6ebf68cfe676dd82_rialo-logo.svg" class="h-10 w-10" alt="RIALO">
        <h1 class="text-xl font-bold">RIALO dApp</h1>
      </a>
      <div class="flex items-center gap-3">
        <div id="walletStatus" class="bg-blue-500/20 text-blue-300 px-3 py-1 rounded-full text-sm border border-blue-500/30">
          <i class="fas fa-wallet mr-1"></i><span id="walletAddress">0x742d...35a9</span>
        </div>
        <button id="connectWalletBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">Connect Wallet</button>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 py-8 relative z-10">

    <section class="gradient-bg rounded-2xl p-8 mb-12 text-center border border-white/20">
      <div class="flex justify-center mb-4">
        <img src="https://cdn.prod.website-files.com/6883572e6ebf68cfe676dd65/6883572e6ebf68cfe676dd82_rialo-logo.svg" class="h-20 w-20" alt="RIALO">
      </div>
      <h1 class="text-4xl font-bold mb-4">RIALO Faucet</h1>
      <p class="text-xl mb-6 max-w-2xl mx-auto">Claim free RIALO tokens. Untuk menghindari bot/cheat, kamu harus lulus verifikasi “main game” terlebih dahulu.</p>
      <div class="glass-card bg-opacity-30 rounded-lg p-4 inline-block border border-white/20">
        <p class="text-lg"><span class="font-bold">100 RLO</span> per klaim</p>
      </div>
    </section>

    <!-- Status Faucet -->
    <section class="mb-12">
      <div class="glass-card rounded-xl shadow-md p-6 mb-6 border border-gray-700">
        <h2 class="text-2xl font-bold mb-4">Faucet Status</h2>
        <div class="mb-4">
          <div class="flex justify-between text-sm text-gray-400 mb-1">
            <span>Daily Limit: 10,000 RLO</span>
            <span id="remainingAmount">8,500 RLO remaining</span>
          </div>
          <div class="progress-bar"><div class="progress-fill bg-green-500" style="width: 15%"></div></div>
        </div>
        <p class="text-gray-400 text-sm">Resets in: <span id="resetTimer" class="font-medium">14:32:45</span></p>
      </div>
    </section>

    <!-- VERIFIKASI MAIN GAME -->
    <section class="mb-12">
      <h2 class="text-2xl font-bold mb-6">Play-to-Verify</h2>

      <div id="playVerifyCard" class="glass-card rounded-xl shadow-md p-6 card-hover border-2 border-gray-700">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-lg font-semibold">Selesaikan tantangan di game</h3>
          <span id="verifyBadge" class="px-2 py-1 text-xs rounded bg-yellow-500/20 text-yellow-300 border border-yellow-500/30">Pending</span>
        </div>
        <ul class="list-disc pl-5 text-gray-300 space-y-1 mb-4">
          <li>Capai <b>Level 7</b></li>
          <li>Bermain aktif minimal <b>5 menit</b> (AFK tidak dihitung)</li>
          <li>Jangan tutup/latarkan tab game saat verifikasi</li>
        </ul>

        <div class="bg-gray-800/60 rounded-lg p-4 mb-4 text-sm text-gray-300">
          <div>Progress: <span id="verifyProgress">0%</span></div>
          <div class="progress-bar mt-2"><div id="verifyBar" class="progress-fill bg-indigo-500" style="width:0%"></div></div>
          <div class="mt-2 grid grid-cols-1 md:grid-cols-3 gap-2">
            <div><span class="text-gray-400">Level:</span> <b id="vLevel">0</b> / 7</div>
            <div><span class="text-gray-400">Active time:</span> <b id="vTime">0:00</b> / 5:00</div>
            <div><span class="text-gray-400">Quality:</span> <b id="vQuality">0%</b></div>
          </div>
        </div>

        <div class="flex flex-col sm:flex-row gap-3">
          <button id="startVerifyBtn" class="w-full sm:w-auto bg-indigo-600 hover:bg-indigo-700 px-4 py-3 rounded-lg">
            <i class="fa-solid fa-gamepad mr-2"></i> Mulai Verifikasi (Popup)
          </button>
          <button id="resetVerifyBtn" class="w-full sm:w-auto bg-gray-700 hover:bg-gray-600 px-4 py-3 rounded-lg">
            Reset
          </button>
        </div>
        <p class="text-gray-400 text-xs mt-3">Jika popup diblokir, izinkan popup untuk domain ini.</p>
      </div>
    </section>

    <!-- KLAIM -->
    <section class="mb-12">
      <div id="claimCard" class="glass-card rounded-xl shadow-md p-6 border-2 border-gray-700">
        <h2 class="text-2xl font-bold mb-4">Claim RIALO Tokens</h2>
        <div class="mb-6">
          <div class="flex items-center justify-between mb-2">
            <p class="text-gray-300">Eligibility Status:</p>
            <span id="eligibilityStatus" class="bg-red-500/20 text-red-400 px-3 py-1 rounded-full text-sm font-medium border border-red-500/30">Not Eligible</span>
          </div>
          <div class="bg-gray-800/50 rounded-lg p-4 text-gray-400">
            <h3 class="font-semibold mb-2 text-gray-200">Requirements:</h3>
            <ul class="list-disc pl-5 space-y-1">
              <li id="reqGame">Lulus verifikasi game (Level 7 + 5 menit aktif)</li>
              <li>Wallet connected</li>
              <li>Daily faucet limit not exceeded</li>
            </ul>
          </div>
        </div>
        <button id="claimButton" disabled class="w-full bg-gray-700 text-gray-400 font-medium py-4 rounded-lg flex items-center justify-center">
          <i class="fas fa-faucet mr-2"></i> Claim 100 RLO
        </button>
        <p class="text-gray-500 text-sm mt-4 text-center">You can claim once every 24 hours</p>
      </div>
    </section>

    <!-- FAQ -->
    <section>
      <h2 class="text-2xl font-bold mb-6">Frequently Asked Questions</h2>
      <div class="glass-card rounded-xl shadow-md p-6 border border-gray-700 text-gray-300">
        <p class="mb-2">Sekarang faucet memakai verifikasi bermain game agar lebih adil dan anti-bot. Kamu wajib mencapai level 7 dan bermain aktif minimal 5 menit.</p>
      </div>
    </section>
  </main>

  <footer class="bg-gray-900/80 py-8 mt-12 border-t border-gray-800">
    <div class="container mx-auto px-4 text-sm text-gray-400 flex flex-col md:flex-row items-center justify-between gap-4">
      <a href="index.html" class="flex items-center gap-2">
        <img src="https://cdn.prod.website-files.com/6883572e6ebf68cfe676dd65/6883572e6ebf68cfe676dd82_rialo-logo.svg" class="h-8 w-8" alt="RIALO"><span class="font-bold text-white">RIALO dApp</span>
      </a>
      <span>© 2025 RIALO Ecosystem.</span>
    </div>
  </footer>

  <script>
    /*** ====== KONFIGURASI KOMUNIKASI DENGAN GAME ====== ***/
    const GAME_ORIGIN = 'https://rialo-shooter.vercel.app';     // whitelist origin game
    const GAME_URL    = GAME_ORIGIN + '/?verify=1';             // jalankan verification mode
    const NEED_LEVEL  = 7;
    const NEED_ACTIVE_SECONDS = 5 * 60;                         // 5 menit
    const QUALITY_MIN = 70;                                     // minimal kualitas permainan (aktifitas) %

    // Elemen UI
    const claimButton   = document.getElementById('claimButton');
    const eligibilityEl = document.getElementById('eligibilityStatus');
    const reqGame       = document.getElementById('reqGame');
    const verifyBadge   = document.getElementById('verifyBadge');
    const verifyBar     = document.getElementById('verifyBar');
    const verifyProgress= document.getElementById('verifyProgress');
    const vLevelEl      = document.getElementById('vLevel');
    const vTimeEl       = document.getElementById('vTime');
    const vQualityEl    = document.getElementById('vQuality');

    let verifyPopup = null;
    let challenge = null;
    let verifiedPayload = null;

    function fmtTime(sec){
      const m = Math.floor(sec/60), s = Math.floor(sec%60);
      return `${String(m).padStart(1,'0')}:${String(s).padStart(2,'0')}`;
    }

    function makeChallenge() {
      const arr = new Uint8Array(16);
      crypto.getRandomValues(arr);
      return Array.from(arr).map(b=>b.toString(16).padStart(2,'0')).join('');
    }

    async function sha256(text){
      const data = new TextEncoder().encode(text);
      const hash = await crypto.subtle.digest('SHA-256', data);
      return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');
    }

    function setEligible(ok){
      if(ok){
        eligibilityEl.textContent = 'Eligible';
        eligibilityEl.className   = 'bg-green-500/20 text-green-400 px-3 py-1 rounded-full text-sm font-medium border border-green-500/30';
        claimButton.disabled = false;
        claimButton.className = 'w-full bg-green-600 hover:bg-green-700 text-white font-medium py-4 rounded-lg flex items-center justify-center';
        reqGame.innerHTML = '<s>Lulus verifikasi game (Level 7 + 5 menit aktif)</s>';
        reqGame.className = 'text-green-400';
        verifyBadge.textContent = 'Verified';
        verifyBadge.className   = 'px-2 py-1 text-xs rounded bg-green-500/20 text-green-300 border border-green-500/30';
      } else {
        eligibilityEl.textContent = 'Not Eligible';
        eligibilityEl.className   = 'bg-red-500/20 text-red-400 px-3 py-1 rounded-full text-sm font-medium border border-red-500/30';
        claimButton.disabled = true;
        claimButton.className = 'w-full bg-gray-700 text-gray-400 font-medium py-4 rounded-lg flex items-center justify-center';
        reqGame.textContent = 'Lulus verifikasi game (Level 7 + 5 menit aktif)';
        reqGame.className   = 'text-gray-400';
        verifyBadge.textContent = 'Pending';
        verifyBadge.className   = 'px-2 py-1 text-xs rounded bg-yellow-500/20 text-yellow-300 border border-yellow-500/30';
      }
    }

    // Mulai verifikasi → buka popup + kirim handshake
    document.getElementById('startVerifyBtn').addEventListener('click', ()=>{
      challenge = makeChallenge();
      const w = 900, h = 700;
      const y = Math.max(0, (screen.height - h)/2);
      const x = Math.max(0, (screen.width  - w)/2);
      verifyPopup = window.open(
        `${GAME_URL}&challenge=${challenge}&returnOrigin=${encodeURIComponent(location.origin)}`,
        'rialo-verify',
        'popup=1,resizable=yes,width='+w+',height='+h+',left='+x+',top='+y
      );
      if(!verifyPopup){ alert('Popup diblokir. Izinkan popup untuk domain ini.'); return; }
      setEligible(false);
    });

    // Reset verifikasi
    document.getElementById('resetVerifyBtn').addEventListener('click', ()=>{
      verifiedPayload = null; setEligible(false);
      verifyBar.style.width = '0%'; verifyProgress.textContent='0%';
      vLevelEl.textContent='0'; vTimeEl.textContent='0:00'; vQualityEl.textContent='0%';
      if(verifyPopup && !verifyPopup.closed) verifyPopup.close();
    });

    // Terima progress & hasil dari game
    window.addEventListener('message', async (ev)=>{
      if(ev.origin !== GAME_ORIGIN) return;             // origin whitelist
      const msg = ev.data || {};
      if(!msg.type) return;

      if(msg.type === 'rialo-verify-progress'){
        const lvl = Number(msg.level||0);
        const at  = Number(msg.activeSeconds||0);
        const q   = Math.round(Number(msg.quality||0));
        const pctLvl = Math.min(100, (lvl/NEED_LEVEL)*100);
        const pctTime= Math.min(100, (at/NEED_ACTIVE_SECONDS)*100);
        const progress = Math.round((pctLvl*0.5 + pctTime*0.5)); // 50:50
        verifyBar.style.width = progress+'%';
        verifyProgress.textContent = progress+'%';
        vLevelEl.textContent = Math.min(lvl, NEED_LEVEL);
        vTimeEl.textContent  = fmtTime(Math.min(at, NEED_ACTIVE_SECONDS));
        vQualityEl.textContent = q+'%';
      }

      if(msg.type === 'rialo-verify-result'){
        // validasi dasar
        if(!challenge || msg.challenge !== challenge){ return; }
        const { level, activeSeconds, quality, ts, checksum } = msg;
        if(!level || !activeSeconds || !ts || !checksum) return;

        // cegah replay lama (>10 menit)
        if(Math.abs(Date.now()-ts) > 10*60*1000) return;

        // verifikasi checksum (anti rekayasa ringan)
        const expected = await sha256(`${challenge}|${level}|${activeSeconds}|${Math.round(quality||0)}|${ts}`);
        if(expected !== checksum) return;

        // cek syarat
        const pass = (level>=NEED_LEVEL) && (activeSeconds>=NEED_ACTIVE_SECONDS) && ((quality||0)>=QUALITY_MIN);
        setEligible(pass);
        if(pass){ verifiedPayload = msg; }
        if(verifyPopup && !verifyPopup.closed) verifyPopup.close();
      }
    });

    /*** ====== CLAIM (dummy) ====== ***/
    claimButton.addEventListener('click', ()=>{
      if(!verifiedPayload){ alert('Selesaikan verifikasi dulu.'); return; }
      alert('Success! 100 RLO akan dikirim (demo).');
      document.getElementById('remainingAmount').textContent = '8,400 RLO remaining';
      document.querySelector('.progress-fill').style.width = '16%';
      claimButton.disabled = true;
      claimButton.innerHTML = '<i class="fas fa-clock mr-2"></i> Come back in 24 hours';
      claimButton.className  = 'w-full bg-gray-700 text-gray-400 font-medium py-4 rounded-lg flex items-center justify-center';
    });

    /*** ====== Timer reset harian (simulasi) ====== ***/
    function tickReset(){
      const now = new Date();
      const midnight = new Date(); midnight.setHours(24,0,0,0);
      const diff = midnight - now;
      const h = Math.floor(diff/36e5), m = Math.floor((diff%36e5)/6e4), s = Math.floor((diff%6e4)/1e3);
      document.getElementById('resetTimer').textContent = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    }
    setInterval(tickReset,1000); tickReset();

    // (opsional) connect wallet dummy
    document.getElementById('connectWalletBtn').addEventListener('click',()=>alert('Wallet connect: implementasi sebenarnya pakai MetaMask/WalletConnect.'));
  </script>
</body>
</html>
